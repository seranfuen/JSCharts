var SERFUEN=function(){var t={CenterPoint:function(t,n,e,i){this.xOffset=e||0,this.yOffset=i||0,this.x=t/2+this.xOffset,this.y=n/2+this.yOffset},CanvasContextchartHelper:function(t){this.canvas=t,this.context=this.canvas.getContext("2d"),this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.origin={x:0,y:0}}};t.CenterPoint.prototype={getRelativePosition:function(t,n){return{x:this.x+t,y:this.y+n}}},t.CanvasContextchartHelper.prototype={clearContext:function(){this.restoreOrigin(),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},getTextSize:function(t,n){return this.context.font=t,this.context.measureText(n).width},changeOrigin:function(t,n){this.restoreOrigin(),this.origin={x:t,y:n},this.context.translate(t,n)},restoreOrigin:function(){this.context.translate(-this.origin.x,-this.origin.y),this.origin={x:0,y:0}}};var n=function(t){this.setData(t),this.showPercentageInSectors=!0,this.showCaptionLocation="right",this.minimumCaption=null,this.colorPalette=["gray","blue","orange","green","pink","brown","purple","yellow","red"],this.sectorLineColor="LightGray",this.sectorLineWidth=2,this.circleLineColor="black",this.circleLineWidth=2,this.font=null};n.prototype={calculateTotal:function(t){return 0==t.length?0:t.map(function(t){return t.value}).reduce(function(t,n){return t+n})},setData:function(t){this.data=t||[],this.total=this.calculateTotal(this.data)},showingChartKey:function(){return this.showingKeyRight()||this.showingKeyLeft()},showingKeyRight:function(){return null!==this.showCaptionLocation&&"RIGHT"==this.showCaptionLocation.toUpperCase()},showingKeyLeft:function(){return null!==this.showCaptionLocation&&"LEFT"==this.showCaptionLocation.toUpperCase()}};var e=function(e,i){function o(){var t,e=new n(i.data);for(t in i)e[t]=i[t];return e}function r(){z=T.getFontSizes(e.width,e.height),k=z.fontSize+"px "+P,W=z.fontSize+"px "+P,K=z.lineHeight,R=a(),I=p()}function a(){function t(){return O.showingChartKey()?O.showingKeyRight()?-(e.width-(e.width-h))/2:this.pieChartSettings.showingKeyLeft()?(e.width-h)/2:0:0}var n=.85,i=.5,o=H.getTextSize(k,"100%"),r=s(),a=H.getTextSize("bold "+W,r),h=Math.min(e.width*i,2*b+2*z.fontSize+a+2*L),l=e.width-(O.showingChartKey()?h:0),c=Math.min(l,e.height),g=c*(O.showingChartKey()?n:1),u=g-2*(A+z.lineHeight),f=g-2*(A+z.lineHeight),d=Math.min(u,f)/2,v=t();return{pieMaxSize:c,keyBoxWidth:h,maxTextWidth:o,maxTextHeight:z.lineHeight,piepieMaxSize:c,radius:d,xOffset:v}}function h(t){return t.name+" - "+(t.valueFormatted||t.value)}function s(){for(var t=O.data.map(function(t){return h(t)}),n=O.minimumCaption,e=0,i=t.length;i>e;e++)(!n||n.length<t[e].length)&&(n=t[e]);return n}function l(){var t=f();H.restoreOrigin();var n=d(),e=0,i=n.length;for(u(t);i>e;e++)c(e,n[e],t),g(e,n[e],t)}function c(t,n,e){var i=e.lineY+t*e.lineHeight,o=e.squareX,r=H.context;r.beginPath(),r.fillStyle=n.color,r.rect(o,i,z.fontSize,z.fontSize),r.fill(),I[t]==F&&(r.strokeStyle="grey",r.lineWidth=2,r.stroke())}function g(t,n,e){var i=e.lineY+t*e.lineHeight,o=e.lineX,r=I[t]==F?"bold "+W:W;S(r,"black",n.caption,{x:o,y:i},"left","hanging")}function u(t){var n=H.context;n.beginPath(),n.fillStyle="white",n.strokeStyle=O.circleLineColor,n.lineWidth=L,n.rect(t.boxStartPoint.x,t.boxStartPoint.y,t.width,t.height),n.fill(),n.stroke()}function f(){function t(){return z.lineHeight*O.data.length+2*(b+L)}var n=t(),i=O.showingKeyLeft()?0:e.width-R.keyBoxWidth-L,o=(e.height-n)/2,r=i+b+z.fontSize/2,a=r+1.5*z.fontSize;return{height:n,width:R.keyBoxWidth,boxStartPoint:{x:i,y:o},lineHeight:z.lineHeight,lineX:a,lineY:o+(b+z.lineHeight)/2,squareX:r}}function d(){return O.data.map(function(t,n){var e=t.name;return null!==e.valueFormatted&&void 0!==e.valueFormatted&&(e+=" - "+t.valueFormatted),{caption:e,color:I[n].color}})}function v(){var n=0,i=new t.CenterPoint(e.width,e.height,R.xOffset,n);H.changeOrigin(i.x,i.y)}function x(t,n){var e=H.context;e.beginPath(),e.moveTo(0,0),e.lineTo(Math.cos(n.startingAngle)*R.radius,Math.sin(n.startingAngle)*R.radius),e.arc(0,0,R.radius,n.startingAngle,n.finishingAngle),e.moveTo(0,0),e.lineTo(Math.cos(n.finishingAngle)*R.radius,Math.sin(n.finishingAngle)*R.radius);var i=e.isPointInPath(t.x,t.y);return e.closePath(),i}function y(t){return O.colorPalette[t%O.colorPalette.length]}function p(){var t,n,e=2*Math.PI,i=.75*e,o=O.data,r=[],a=0,h=function(){var n=y(t),i=o[t].value,r=o[t].value*(e/O.total);return{startingAngle:a,finishingAngle:Math.min(e,r+a),angle:r,value:i,color:n,bisectingAngle:r/2+a,percentage:i/O.total*100,getBisectingWidth:function(t){return Math.sin(r/2)*t},isMouseOver:!1}},s=function(){if(r.length>1){var t,n=r[0],o=i-n.angle/2,a=r.length;for(t=0;a>t;t++){var h=r[t];h.startingAngle=(h.startingAngle+o)%e,h.finishingAngle=(h.finishingAngle+o)%e,h.bisectingAngle=(h.bisectingAngle+o)%e}}else if(1==r.length){var n=r[0];n.bisectingAngle=(n.angle/2-i)%e}};for(t=0,n=o.length;n>t;t++)r[t]=h(),a+=r[t].angle;return r.length>0&&r[r.length-1].color==r[0].color&&(r[r.length-1].color=y(Math.round((r.length-1)/2))),s(),r}function C(t,n,e){var i=H.context;i.fillStyle=t,i.beginPath(),i.moveTo(0,0),i.arc(0,0,R.radius,n,e),i.fill()}function w(t,n,e){var i=H.context;i.strokeStyle=t,i.lineWidth=n,i.lineCap="round",i.beginPath(),i.moveTo(0,0),i.lineTo(Math.cos(e)*R.radius,Math.sin(e)*R.radius),i.stroke()}function m(t,n){var e=H.context;e.strokeStyle=t,e.lineWidth=n,e.beginPath(),e.arc(0,0,R.radius,0,2*Math.PI),e.stroke()}function S(t,n,e,i,o,r){var a=H.context;a.fillStyle=n,a.textAlign=o||"center",a.textBaseline=r||"middle",a.font=t,a.fillText(e,i.x,i.y)}var M=this,P="ARIAL",A=5,b=10,L=3,O=o(),T={getFontSizes:function(t,n){function e(){return null!==O.font?O.font:400>o?10:o>=400&&800>o?14+.025*(o-400):24}function i(){return 400>o?2:o>400&&800>=o?2.0075:6}var o=Math.min(t,n),r=e(),a=i()+r;return{fontSize:r,lineHeight:a}}},H=new t.CanvasContextchartHelper(e),z=T.getFontSizes(e.width,e.height),k=z.fontSize+"px "+P,W=z.fontSize+"px "+P,K=z.lineHeight,R=a(),I=p(),F=null;this.drawPieChart=function(){H.clearContext(),v();var t,n,e;for(t=0,n=I.length;n>t;t++)e=I[t],e.isMouseOver&&(H.context.globalAlpha=.5),C(e.color,e.startingAngle,e.finishingAngle),H.context.globalAlpha=1;if(O.sectorLineColor&&I.length>1)for(t=0,n=I.length;n>t;t++)e=I[t],w(O.sectorLineColor,O.sectorLineWidth,e.finishingAngle);if(O.circleLineColor&&m(O.circleLineColor,O.circleLineWidth),O.showPercentageInSectors)for(t=0,n=I.length;n>t;t++){e=I[t];var i=Math.round(e.percentage)+"%",o={x:Math.cos(e.bisectingAngle)*(R.radius+R.maxTextWidth/2+A),y:Math.sin(e.bisectingAngle)*(R.radius+R.maxTextHeight/2+A)};S(k,"black",i,o)}O.showingChartKey()&&l()},this.disable=function(){e.removeEventListener("mousemove",B.onMouseMove),H.clearContext()},this.setData=function(t){O.setData(t),r()},this.setOption=function(t,n){"data"==t?this.setData(n):(O[t]=n,r())},this.getOption=function(t){return O[t]};var B=function(){var t=function(t){v();var n=this.getBoundingClientRect(),e={x:t.clientX-n.left,y:t.clientY-n.top},i=F;F=null;var o,r,a,h=!0;for(o=0,r=I.length;r>o;o++){a=I[o];var s=x(e,a);a.isMouseOver=s&&h,a.isMouseOver&&(F=a,h=!1)}(null===F&&null!==i||null!==F&&null===i||null!==F&&null!==i&&F.startingAngle!==i.startingAngle)&&M.drawPieChart(),H.restoreOrigin()};return{onMouseMove:t}}();O.showingChartKey()&&e.addEventListener("mousemove",B.onMouseMove)};e.VERSION="0.0.1",e.cache=[],e.PieChartContext=function(t,n){var i=document.getElementById(t),o=new e(i,n);this.show=function(){o.drawPieChart()},this.hide=function(){o.disable()},this.setData=function(t){o.setData(t),o.drawPieChart()},this.option=function(t,n){return void 0!==n&&(o.setOption(t,n),o.drawPieChart()),o.getOption(t,n)}};var i=function(t,n){return t in e.cache||(e.cache[t]=new e.PieChartContext(t,n),e.cache[t].show()),e.cache[t]};return{pieChart:i}}();